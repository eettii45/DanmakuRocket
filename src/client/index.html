<!-- 

    客户端index.html
    显示在参会者手机上
    功能：
        1. 连接到server
        2. 发送弹幕

-->
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>发送弹幕 | DanmuRocket</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="format-detection" content="telephone=no">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <link rel="alternate icon" type="image/png" href="/i/favicon.png">
  <link rel="stylesheet" href="http://cdn.amazeui.org/amazeui/2.7.2/css/amazeui.min.css"/>
  <style>
    .header {
      text-align: center;
    }
    .header h1 {
      font-size: 200%;
      color: #333;
      margin-top: 30px;
    }
    .header p {
      font-size: 14px;
    }
  </style>
</head>

<script>
  var ws = new WebSocket("ws://live.luojia.cc:1103/");
  ws.onmessage = function(evt) {
    let regexSuccess = new RegExp("You sent: (.*)");
    let regexError = new RegExp("Failed to send: (.*)");
    let data = evt.data;
    let success = regexSuccess.exec(data);
    let error = regexError.exec(data);
    if(success != null){
      alert('发送成功！\n你发送的消息是：'+success[1]);
    } 
    if(error != null){
      alert('发送失败！请检查你的输入并重试！\n你发送的消息是：'+error[1]);
    } 
    textChange();
  }
  function bodyLoad() {
    let arr = ["666666!", "233333", "XXX加油！", "XXX太帅了！"];
    var item = arr[Math.floor(Math.random()*arr.length)];
    document.getElementById("msg").placeholder = item;
  }
  function textChange() {
    let value = document.getElementById("msg").value;
    let btn = document.getElementById("btn");
    if(value == "") {
      btn.textContent = "请先输入弹幕";
      btn.disabled = true;
    } else {
      btn.textContent = "点我发送！";
      btn.disabled = false;
    }
  }
  function sendButtonClick() {
    let value = document.getElementById("msg").value;
    ws.send(value);
    btn.textContent = "正在发送中...";
    btn.disabled = true;
    document.getElementById("msg").value = "";
  }
</script>

<body onload="bodyLoad()">
<div class="header">
  <div class="am-g">
    <h1>发送弹幕</h1>
  </div>
  <hr />
</div>
<div class="am-g">
  <div class="am-u-lg-6 am-u-md-8 am-u-sm-centered">
    <div>
        <label>输入您要发送的弹幕：</label>
        <br>
        <textarea id="msg" oninput="textChange()" rows="5" style="width:100%" placeholder="666666!"></textarea>    
    </div>
    <br>
    <div>
        <button id="btn" disabled=true onclick="sendButtonClick()" class="am-btn am-btn-primary am-btn-sm am-fl">请先输入弹幕</button>
    </div>
    <br>
    <hr>
    <p style="color:gray;">版权所有© 2018 华中科技大学计算机科学与技术学院2018级13班. Licensed under MIT. All rights reserved.</p>
  </div>
</div>
</body>
</html>
